<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test de chargement des scripts</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            padding: 2rem;
            max-width: 800px;
            margin: 0 auto;
            background: #f5f5f5;
        }
        .test-result {
            padding: 1rem;
            margin: 0.5rem 0;
            border-radius: 8px;
            background: white;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .success { border-left: 4px solid #10b981; }
        .error { border-left: 4px solid #ef4444; }
        .warning { border-left: 4px solid #f59e0b; }
        button {
            background: #3b82f6;
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 6px;
            cursor: pointer;
            margin: 0.5rem;
        }
        button:hover {
            background: #2563eb;
        }
    </style>
</head>
<body>
    <h1>Test de chargement des scripts</h1>
    
    <button onclick="testAll()">Tester tout</button>
    <button onclick="location.href='/'">Retour à l'accueil</button>
    
    <div id="results"></div>
    
    <script>
        function addResult(message, type = 'success') {
            const div = document.createElement('div');
            div.className = `test-result ${type}`;
            div.textContent = message;
            document.getElementById('results').appendChild(div);
        }
        
        async function testAll() {
            const results = document.getElementById('results');
            results.innerHTML = '';
            
            // Test 1: Charger search-system.js
            addResult('Test 1: Chargement de search-system.js...', 'warning');
            try {
                const script1 = document.createElement('script');
                script1.src = `/js/search-system.js?v=${Date.now()}`;
                await new Promise((resolve, reject) => {
                    script1.onload = resolve;
                    script1.onerror = reject;
                    document.head.appendChild(script1);
                });
                
                if (typeof SearchSystem !== 'undefined') {
                    addResult('✅ SearchSystem chargé avec succès', 'success');
                    addResult(`✅ Thèmes de jeux: ${window.gameThemes ? window.gameThemes.length : 0}`, 'success');
                    addResult(`✅ Thèmes de contraintes: ${window.constraintThemes ? window.constraintThemes.length : 0}`, 'success');
                } else {
                    addResult('❌ SearchSystem non trouvé', 'error');
                }
            } catch (e) {
                addResult(`❌ Erreur chargement search-system.js: ${e.message}`, 'error');
            }
            
            // Test 2: Charger auth.js
            addResult('Test 2: Chargement de auth.js...', 'warning');
            try {
                const script2 = document.createElement('script');
                script2.src = `/js/auth.js?v=${Date.now()}`;
                await new Promise((resolve, reject) => {
                    script2.onload = resolve;
                    script2.onerror = reject;
                    document.head.appendChild(script2);
                });
                
                if (typeof AuthManager !== 'undefined') {
                    addResult('✅ AuthManager chargé avec succès', 'success');
                    
                    // Tester l'auth sans erreur 401
                    const authManager = new AuthManager();
                    await new Promise(resolve => setTimeout(resolve, 500));
                    
                    if (authManager.isAuthenticated) {
                        addResult(`✅ Utilisateur authentifié: ${authManager.user?.email || 'inconnu'}`, 'success');
                    } else {
                        addResult('✅ Utilisateur non authentifié (normal)', 'warning');
                    }
                } else {
                    addResult('❌ AuthManager non trouvé', 'error');
                }
            } catch (e) {
                addResult(`❌ Erreur chargement auth.js: ${e.message}`, 'error');
            }
            
            // Test 3: Créer SearchSystem
            addResult('Test 3: Création d\'une instance SearchSystem...', 'warning');
            try {
                if (typeof SearchSystem !== 'undefined') {
                    const searchSystem = new SearchSystem();
                    addResult('✅ SearchSystem créé avec succès', 'success');
                    
                    // Vérifier le thème actuel
                    if (searchSystem.currentGameTheme) {
                        addResult(`✅ Thème de jeu actuel: ${searchSystem.currentGameTheme}`, 'success');
                    }
                    
                    // Simuler une recherche
                    const input = document.createElement('input');
                    input.id = 'heroSearchInput';
                    document.body.appendChild(input);
                    searchSystem.searchInput = input;
                    
                    addResult('✅ SearchSystem initialisé correctement', 'success');
                    
                    // Nettoyer
                    input.remove();
                } else {
                    addResult('❌ SearchSystem non disponible', 'error');
                }
            } catch (e) {
                addResult(`❌ Erreur création SearchSystem: ${e.message}`, 'error');
            }
            
            // Test 4: Vérifier les jeux ultra
            addResult('Test 4: Chargement des jeux ultra-modernes...', 'warning');
            try {
                const script3 = document.createElement('script');
                script3.src = `/js/ai-loader-games-ultra.js?v=${Date.now()}`;
                await new Promise((resolve, reject) => {
                    script3.onload = resolve;
                    script3.onerror = reject;
                    document.head.appendChild(script3);
                });
                
                const gameClasses = [
                    'UltraModernSnakeGame',
                    'UltraModernBreakoutGame', 
                    'UltraModernSpaceShooterGame'
                ];
                
                let allFound = true;
                for (const className of gameClasses) {
                    if (typeof window[className] !== 'undefined') {
                        addResult(`✅ ${className} trouvé`, 'success');
                    } else {
                        addResult(`❌ ${className} non trouvé`, 'error');
                        allFound = false;
                    }
                }
                
                if (allFound) {
                    addResult('✅ Tous les jeux ultra-modernes sont disponibles!', 'success');
                }
            } catch (e) {
                addResult(`❌ Erreur chargement jeux: ${e.message}`, 'error');
            }
            
            addResult('🏁 Tests terminés!', 'success');
        }
        
        // Lancer les tests automatiquement
        window.addEventListener('load', () => {
            setTimeout(testAll, 1000);
        });
    </script>
</body>
</html>